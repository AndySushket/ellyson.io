# WebAssembly Sphere with npm

This directory contains the WebAssembly implementation of a sphere generator and animator using npm WebAssembly.

## Overview

The implementation uses C code compiled to WebAssembly using Emscripten, but loads the WebAssembly module using npm packages instead of script tags. This approach provides better integration with modern JavaScript module systems and build tools.

## Files

- `sphere.c` - C code that defines functions for calculating sphere vertices, colors, and animations
- `build.sh` - Build script that compiles the C code to WebAssembly and sets up the npm module
- `sphere.wasm` - Compiled WebAssembly binary (generated by build.sh)
- `sphere.js` - JavaScript glue code for the WebAssembly module (generated by build.sh)

## npm WebAssembly Approach

The npm WebAssembly approach uses ES6 modules to import and load the WebAssembly module. The key components are:

1. **emscripten-wasm-loader** - An npm package that helps load Emscripten-compiled WebAssembly modules
2. **ES6 Module Integration** - The WebAssembly module is compiled with ES6 module support
3. **Fallback Mechanism** - A fallback to the traditional script tag approach is provided for compatibility

## Build Process

The build process compiles the C code to WebAssembly and sets up the npm module structure:

1. Compiles `sphere.c` to WebAssembly using Emscripten with ES6 module support
2. Creates an `index.js` file that exports a function to load the WebAssembly module
3. Copies the compiled files to the public directory for fallback

## Usage

To use the WebAssembly module in your code:

```javascript
import loadSphereModule from './npm-wasm';

async function init() {
  try {
    const wasmModule = await loadSphereModule();
    
    // Use the WebAssembly module
    // Example: Calculate sphere vertices
    const verticesPtr = wasmModule._malloc(numVertices * 3 * 4); // 3 floats per vertex, 4 bytes per float
    wasmModule._calculateSphereVertices(verticesPtr, resolution, radius);
    
    // Don't forget to free the memory when done
    wasmModule._free(verticesPtr);
  } catch (error) {
    console.error('Failed to load WebAssembly module:', error);
  }
}
```

## Building

To build the WebAssembly module:

1. Make sure Emscripten is installed and activated
2. Run the build script:

```bash
cd src/app/projects/webAssembley/test2/wasm
./build.sh
```

## Advantages of npm WebAssembly

- Better integration with modern JavaScript module systems
- No need for global variables or script tags
- Works well with bundlers like webpack
- Cleaner code organization
- Better error handling
- Easier to maintain and update
